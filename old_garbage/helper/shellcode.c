#include <stdio.h>
#include <sys/mman.h>
#include <unistd.h>
#include <stdint.h>
#include <string.h>

// Ton shellcode ici
unsigned char shellcode[] ="\x52\x48\xbf\x1c\x10\x40\x00\x00\x00\x00\x00\xe8\xf6\x01\x00\x00\x5a\xb8\x3c\x00\x00\x00\x48\x31\xff\x0f\x05\xc3\x68\x65\x6c\x6c\x6f\x00\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x0f\x1f\x40\x00\x48\x89\xf8\x48\x89\xf7\x48\x89\xd6\x48\x89\xca\x4d\x89\xc2\x4d\x89\xc8\x4c\x8b\x4c\x24\x08\x0f\x05\x48\x85\xc0\x78\x01\xc3\x48\xf7\xd8\xc3\x55\x48\x89\xe5\x48\x89\x7d\xe8\xc7\x45\xfc\x00\x00\x00\x00\xeb\x04\x83\x45\xfc\x01\x8b\x45\xfc\x48\x63\xd0\x48\x8b\x45\xe8\x48\x01\xd0\x0f\xb6\x00\x84\xc0\x75\xe8\x8b\x45\xfc\x5d\xc3\x55\x48\x89\xe5\x48\x89\x7d\xf8\x48\x89\x75\xf0\xeb\x0a\x48\x83\x45\xf8\x01\x48\x83\x45\xf0\x01\x48\x8b\x45\xf8\x0f\xb6\x00\x84\xc0\x74\x1d\x48\x8b\x45\xf0\x0f\xb6\x00\x84\xc0\x74\x12\x48\x8b\x45\xf8\x0f\xb6\x10\x48\x8b\x45\xf0\x0f\xb6\x00\x38\xc2\x74\xce\x48\x8b\x45\xf8\x0f\xb6\x00\x0f\xbe\xd0\x48\x8b\x45\xf0\x0f\xb6\x00\x0f\xbe\xc0\x29\xc2\x89\xd0\x5d\xc3\x55\x48\x89\xe5\x48\x83\xec\x10\x48\x89\x7d\xf8\x48\x89\x75\xf0\x48\x8b\x45\xf0\x48\x89\xc7\xe8\x5c\xff\xff\xff\x89\xc2\x48\x8b\x45\xf0\x89\xd1\x48\x89\xc2\xbe\x01\x00\x00\x00\xbf\x01\x00\x00\x00\xb8\x00\x00\x00\x00\xe8\x1a\xff\xff\xff\x90\xc9\xc3\x55\x48\x89\xe5\x48\x81\xec\xc0\x00\x00\x00\x48\x89\xbd\x48\xff\xff\xff\x48\x8b\x85\x48\xff\xff\xff\xba\x00\x00\x00\x00\x48\x89\xc6\xbf\x02\x00\x00\x00\xb8\x00\x00\x00\x00\xe8\xe7\xfe\xff\xff\x89\x45\xfc\x83\x7d\xfc\x00\x0f\x88\xaa\x00\x00\x00\x48\x8d\x95\x50\xff\xff\xff\x8b\x45\xfc\x89\xc6\xbf\x05\x00\x00\x00\xb8\x00\x00\x00\x00\xe8\xbf\xfe\xff\xff\x48\x8b\x45\x80\x8b\x55\xfc\x48\x83\xec\x08\x6a\x00\x41\x89\xd1\x41\xb8\x02\x00\x00\x00\xb9\x01\x00\x00\x00\x48\x89\xc2\xbe\x00\x00\x00\x00\xbf\x09\x00\x00\x00\xb8\x00\x00\x00\x00\xe8\x8d\xfe\xff\xff\x48\x83\xc4\x10\x48\x89\x45\xf0\x48\x83\x7d\xf0\xff\x74\x51\x48\x8b\x45\xf0\x48\x89\x45\xe8\x48\x8b\x95\x48\xff\xff\xff\x48\x8b\x45\xe8\x48\x89\xd6\x48\x89\xc7\xe8\x0b\xff\xff\xff\x48\x8b\x55\x80\x48\x8b\x45\xf0\x48\x89\xc6\xbf\x0b\x00\x00\x00\xb8\x00\x00\x00\x00\xe8\x46\xfe\xff\xff\x8b\x45\xfc\x89\xc6\xbf\x03\x00\x00\x00\xb8\x00\x00\x00\x00\xe8\x32\xfe\xff\xff\xeb\x04\x90\xeb\x01\x90\xc9\xc3\x55\x48\x89\xe5\x48\x83\xec\x10\x48\x89\x7d\xf8\x48\x8b\x45\xf8\x48\x89\xc7\xe8\xfb\xfe\xff\xff\x90\xc9\xc3";

int main() {

	mprotect((void *)((uintptr_t)shellcode & ~(sysconf(_SC_PAGE_SIZE) - 1)), sysconf(_SC_PAGE_SIZE), PROT_READ | PROT_WRITE | PROT_EXEC);

    // Pointeur vers le shellcode + 60 (adresse de la fonction _start)
    void (*func)() = (void (*)())((unsigned char *)shellcode);

    // Exécution du shellcode
    func();  // Appel du shellcode

    // Libération de la mémoire

    return 0;
}
