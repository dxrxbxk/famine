#include <stdio.h>
#include <sys/mman.h>
#include <unistd.h>
#include <stdint.h>
#include <string.h>

// Ton shellcode ici
unsigned char shellcode[] = {
    0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x57,
    0x6f, 0x72, 0x6c, 0x64, 0x21, 0x0a, 0x00, 0x90,
    0x0e, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
    0x55, 0x48, 0x89, 0xe5, 0x89, 0x7d, 0xec, 0x48,
    0x89, 0x75, 0xe0, 0x48, 0x89, 0x55, 0xd8, 0x48,
    0x8b, 0x7d, 0xec, 0x48, 0x8b, 0x75, 0xe0, 0x48,
    0x8b, 0x55, 0xd8, 0x48, 0xc7, 0xc0, 0x01, 0x00,
    0x00, 0x00, 0x0f, 0x05, 0x48, 0x89, 0xc0, 0x48,
    0x89, 0x45, 0xf8, 0x48, 0x8b, 0x45, 0xf8, 0x5d,
    0xc3, 0x55, 0x48, 0x89, 0xe5, 0x89, 0x7d, 0xfc,
    0x48, 0x8b, 0x7d, 0xfc, 0x48, 0xc7, 0xc0, 0x3c,
    0x00, 0x00, 0x00, 0x0f, 0x05, 0x90, 0x5d, 0xc3,
    0x55, 0x48, 0x89, 0xe5, 0xb8, 0x0e, 0x00, 0x00,
    0x00, 0x48, 0x98, 0xb9, 0x01, 0x00, 0x00, 0x00,
    0x48, 0x89, 0xc2, 0x48, 0x8d, 0x05, 0x86, 0xff,
    0xff, 0xff, 0x48, 0x89, 0xc6, 0x89, 0xcf, 0xe8,
    0x94, 0xff, 0xff, 0xff, 0xbf, 0x00, 0x00, 0x00,
    0x00, 0xe8, 0xbb, 0xff, 0xff, 0xff, 0x90, 0x5d,
    0xc3
};

int main() {

	mprotect((void *)((uintptr_t)shellcode & ~(sysconf(_SC_PAGE_SIZE) - 1)), sysconf(_SC_PAGE_SIZE), PROT_READ | PROT_WRITE | PROT_EXEC);

    // Pointeur vers le shellcode + 60 (adresse de la fonction _start)
    void (*func)() = (void (*)())((unsigned char *)shellcode + 0x60);

    // Exécution du shellcode
    func();  // Appel du shellcode

    // Libération de la mémoire

    return 0;
}
